#!/usr/bin/env bash
# Screenshot tool: saves file + copies to clipboard
#
# Usage: screenshot [--file|--image] [region|full]
#   --image (default) - copy as image/png (for pasting into apps)
#   --file            - copy as file reference (for pasting into Thunar)
#   region (default)  - select a region with slurp
#   full              - capture all outputs

SCREENSHOT_DIR="$HOME/Pictures/Screenshots"
mkdir -p "$SCREENSHOT_DIR"

CLIP="image"
MODE="region"

for arg in "$@"; do
    case "$arg" in
        --file)  CLIP="file" ;;
        --image) CLIP="image" ;;
        region)  MODE="region" ;;
        full)    MODE="full" ;;
    esac
done

FILE="$SCREENSHOT_DIR/screenshot-$(date +%Y%m%d-%H%M%S).png"

if [ "$MODE" = "region" ]; then
    GEOM=$(slurp) || exit 0
    grim -g "$GEOM" "$FILE" || exit 1
else
    grim "$FILE" || exit 1
fi

if [ "$CLIP" = "file" ]; then
    printf 'copy\nfile://%s' "$FILE" | wl-copy -t x-special/gnome-copied-files
else
    wl-copy -t image/png < "$FILE"
fi
